{% extends "base.html" %}
{% block content %}

<h1 class="page-title">ユーザー画面</h1>
<p class="page-sub">自分の予約一覧です。状態に応じて「入庫」「出庫」ができます。</p>

<div class="grid">
  <div class="col-12 card">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
      <div style="display:flex; gap:8px; align-items:center;">
        <span class="badge">RESERVATION</span>
        <span class="badge badge-wait">WAITING</span>
        <span class="badge badge-active">ACTIVE</span>
      </div>
      <a class="btn btn-primary" href="{{ url_for('user_reserve') }}">＋ 予約を作成</a>
    </div>

    {% if reservations %}
      <table>
        <tr>
          <th style="width:160px;">ID</th>
          <th>車牌</th>
          <th style="width:140px;">区画</th>
          <th style="width:140px;">状態</th>
          <th style="width:180px;">操作</th>
        </tr>

        {% for r in reservations %}
        <tr>
          <td><span class="badge">{{ r.reservation_id }}</span></td>
          <td>{{ r.license_plate }}</td>
          <td>{{ r.spot_id }}</td>

          <td>
            {% if r.status == ReservationStatus.WAITING %}
              <span class="badge badge-wait">{{ r.status.value }}</span>
            {% elif r.status == ReservationStatus.ACTIVE %}
              <span class="badge badge-active">{{ r.status.value }}</span>
            {% else %}
              <span class="badge">{{ r.status.value }}</span>
            {% endif %}
          </td>

          <td>
            {% if r.status == ReservationStatus.RESERVATION %}
              <form method="post" action="{{ url_for('user_checkin', reservation_id=r.reservation_id) }}">
                <button class="btn-primary">入庫（受付）</button>
              </form>

            {% elif r.status == ReservationStatus.WAITING %}
              <span style="color:var(--muted); font-size:14px;">入庫待ち中</span>

            {% elif r.status == ReservationStatus.ACTIVE %}
              <form method="post" action="{{ url_for('user_checkout', reservation_id=r.reservation_id) }}">
                <button class="btn-danger">出庫</button>
              </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </table>
    {% else %}
      <div class="empty">予約はまだありません。右上の「予約を作成」から作れます。</div>
    {% endif %}
  </div>
</div>

{% endblock %}
