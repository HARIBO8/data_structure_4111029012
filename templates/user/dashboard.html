{% extends "base.html" %}
{% block content %}

<h1 class="page-title">使用者畫面</h1>
<p class="page-sub">以下為您的預約清單，可依狀態進行「入庫」或「出庫」操作。</p>

<div class="grid">
  <div class="col-12 card">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
      <div style="display:flex; gap:8px; align-items:center;">
        <span class="badge">RESERVATION（已預約）</span>
        <span class="badge badge-wait">WAITING（等待入庫）</span>
        <span class="badge badge-active">ACTIVE（已入庫）</span>
      </div>
      <a class="btn btn-primary" href="{{ url_for('user_reserve') }}">＋ 建立新預約</a>
    </div>

    {% if reservations %}
      <table>
        <tr>
          <th style="width:160px;">預約 ID</th>
          <th>車牌</th>
          <th style="width:140px;">停車格</th>
          <th style="width:140px;">狀態</th>
          <th style="width:180px;">操作</th>
        </tr>

        {% for r in reservations %}
        <tr>
          <td><span class="badge">{{ r.reservation_id }}</span></td>
          <td>{{ r.license_plate }}</td>
          <td>{{ r.spot_id }}</td>

          <td>
            {% if r.status == ReservationStatus.WAITING %}
              <span class="badge badge-wait">{{ r.status.value }}</span>
            {% elif r.status == ReservationStatus.ACTIVE %}
              <span class="badge badge-active">{{ r.status.value }}</span>
            {% else %}
              <span class="badge">{{ r.status.value }}</span>
            {% endif %}
          </td>

          <td>
            {% if r.status == ReservationStatus.RESERVATION %}
              <form method="post" action="{{ url_for('user_checkin', reservation_id=r.reservation_id) }}">
                <button class="btn-primary">申請入庫</button>
              </form>

            {% elif r.status == ReservationStatus.WAITING %}
              <span style="color:var(--muted); font-size:14px;">等待管理者放行中</span>

            {% elif r.status == ReservationStatus.ACTIVE %}
              <form method="post" action="{{ url_for('user_checkout', reservation_id=r.reservation_id) }}">
                <button class="btn-danger">出庫</button>
              </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </table>
    {% else %}
      <div class="empty">目前尚無預約，可點擊右上角「建立新預約」進行新增。</div>
    {% endif %}
  </div>
</div>

{% endblock %}
